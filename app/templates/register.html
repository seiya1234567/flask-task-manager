<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>新規ユーザー登録 - タスク管理システム</title>
    <link
        href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
        rel="stylesheet"
    />
    <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"
    />
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;600;700&display=swap"
        rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/stylesheet.css') }}">
</head>
<body class="bg-gray-50">
    <div class="min-h-screen py-8 px-4">
        <div class="max-w-4xl mx-auto">
            <!-- ヘッダー -->
            <div class="header-gradient rounded-2xl p-8 mb-8 text-white shadow-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-4xl font-bold mb-2">
                            <i class="fas fa-user-plus mr-3"></i>新規ユーザー登録
                        </h1>
                        <p class="text-blue-100">アカウントを作成して、タスク管理を始めましょう</p>
                    </div>
                    <div class="hidden md:block">
                        <div class="bg-white bg-opacity-20 rounded-xl p-4">
                            <i class="fas fa-user-circle text-4xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- メインフォーム -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                <div class="p-8">
                    <form id = "registerForm" action="/register" method="POST" class="space-y-6">
                        <!-- ユーザー名 -->
                        <div class="form-section">
                            <label for="username" class="block text-lg font-semibold text-gray-800 mb-3">
                                <i class="fas fa-user text-blue-600 mr-2"></i>
                                ユーザー名
                                <span class="required-asterisk ml-1">*</span>
                            </label>
                            <input
                                type="text"
                                id="username"
                                name="username"
                                required
                                class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent text-gray-800 font-medium"
                                placeholder="ユーザー名を入力してください"
                            />
                            {% if errors and errors.username %}
                                <div class="text-red-600 mb-4" style="display: block;">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ errors.username }}
                                </div>
                            {% endif %}
                        </div>

                        <!-- メールアドレス -->
                        <div class="form-section">
                            <label for="email" class="block text-lg font-semibold text-gray-800 mb-3">
                                <i class="fas fa-envelope text-green-600 mr-2"></i>
                                メールアドレス
                                <span class="required-asterisk ml-1">*</span>
                            </label>
                            <input
                                type="email"
                                id="email"
                                name="email"
                                required
                                class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-transparent text-gray-800 font-medium"
                                placeholder="メールアドレスを入力してください"
                            />
                            {% if errors and errors.email %}
                                <div class="text-red-600 mb-4" style="display: block;">
                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                    {{ errors.email}}
                                </div>
                            {% endif %}
                        </div>

                        <!-- パスワード -->
                        <div class="form-section">
                            <label for="password" class="block text-lg font-semibold text-gray-800 mb-3">
                                <i class="fas fa-lock text-red-600 mr-2"></i>
                                パスワード
                                <span class="required-asterisk ml-1">*</span>
                            </label>
                            <div class="relative">
                                <input
                                    type="password"
                                    id="password"
                                    name="password"
                                    required
                                    class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-transparent text-gray-800 font-medium"
                                    placeholder="パスワードを入力してください"
                                />
                                <button
                                    type="button"
                                    id="togglePasswordMain"
                                    class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors duration-200 z-10"
                                >
                                    <i class="fas fa-eye" id="eyeIconMain"></i>
                                </button>
                                <div id="passwordError" class="error-message">
                                <i class="fas fa-exclamation-circle mr-1"></i>パスワードは8文字以上で入力してください
                                </div>
                            </div>
                        </div>

                        <!-- パスワード再入力 -->
                        <div class="form-section">
                            <label for="password_confirm" class="block text-lg font-semibold text-gray-800 mb-3">
                                <i class="fas fa-lock text-red-400 mr-2"></i>
                                パスワード再入力
                                <span class="required-asterisk ml-1">*</span>
                            </label>
                            <div class="relative">
                                <input
                                    type="password"
                                    id="password_confirm"
                                    name="password_confirm"
                                    required
                                    class="form-input w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-red-400 focus:border-transparent text-gray-800 font-medium"
                                    placeholder="もう一度パスワードを入力してください"
                                />
                                <button
                                        type="button"
                                        id="togglePasswordConfirm"
                                        class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors duration-200 z-10"
                                    >
                                        <i class="fas fa-eye" id="eyeIconConfirm"></i>
                                </button>
                            </div>
                            <div id="passwordMismatchError" class="error-message text-red-600 mt-2" style="display:none;">
                                <i class="fas fa-exclamation-circle mr-1"></i>パスワードと再入力パスワードが一致しません。
                            </div>
                        </div>

                        <!-- ボタンエリア -->
                        <div class="pt-8 border-t border-gray-200">
                            <div class="flex flex-col sm:flex-row gap-4 justify-end">
                                <button
                                    type="submit"
                                    class="btn-primary inline-flex items-center justify-center px-8 py-3 text-white font-semibold rounded-xl transition-all duration-200 shadow-lg"
                                >
                                    <i class="fas fa-user-plus mr-2"></i>
                                    確認にすすむ
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const registerForm = document.getElementById('registerForm');
        const password = document.getElementById('password');
        const passwordConfirm = document.getElementById('password_confirm');
        const passwordError = document.getElementById('passwordError');
        const togglePassword = document.getElementById('togglePassword');
        const eyeIcon = document.getElementById('eyeIcon');

        // 初期はパスワードエラー非表示
        passwordError.style.display = 'none';

        // パスワード表示切替
        togglePasswordMain.addEventListener('click', () => {
        const type = password.type === 'password' ? 'text' : 'password';
        password.type = type;
        eyeIconMain.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
        });

        // 再入力パスワード表示切替
        togglePasswordConfirm.addEventListener('click', () => {
        const type = passwordConfirm.type === 'password' ? 'text' : 'password';
        passwordConfirm.type = type;
        eyeIconConfirm.className = type === 'password' ? 'fas fa-eye' : 'fas fa-eye-slash';
        });
                    
        // メールバリデーション関数
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // パスワードバリデーション関数
        function validatePassword(pwd) {
            return pwd.length >= 8;
        }

        // エラー表示切替
        function showError(fieldId, show = true) {
            const errorElement = document.getElementById(fieldId + 'Error');
            if (errorElement) {
                errorElement.style.display = show ? 'block' : 'none';
            }
        }

        // リアルタイムでパスワード長チェック
        password.addEventListener('input', function() {
            if (!validatePassword(password.value)) {
                showError('password', true);
            } else {
                showError('password', false);
            }
        });

        // メールアドレスリアルタイムチェック（blur時）
        const emailInput = document.getElementById('email');
        emailInput.addEventListener('blur', function() {
            const valid = validateEmail(emailInput.value);
            if (!valid && emailInput.value !== '') {
                emailInput.classList.add('border-red-500');
                emailInput.classList.remove('border-gray-300');
            } else {
                emailInput.classList.remove('border-red-500');
                emailInput.classList.add('border-gray-300');
            }
            showError('email', !valid && emailInput.value !== '');
        });

        // フォーム送信時バリデーション
        registerForm.addEventListener('submit', function(e) {
            const email = emailInput.value;
            const pwd = password.value;
            const pwdConfirm = passwordConfirm.value;
            const mismatchError = document.getElementById('passwordMismatchError');

            const emailValid = validateEmail(email);
            const passwordValid = validatePassword(pwd);

            showError('email', !emailValid);
            showError('password', !passwordValid);

            if (!emailValid || !passwordValid) {
                e.preventDefault();
                return;
            }

            if (pwd !== pwdConfirm) {
                e.preventDefault();
                mismatchError.style.display = 'block'; // エラー表示
                passwordConfirm.focus();
                return;
            }
        });
    });
    </script>

</body>
</html>
