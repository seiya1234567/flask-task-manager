# ================================
# Handover Notes
# ================================

## プロジェクト概要
- Flask + SQLAlchemy のタスク管理アプリ
- 認証（登録 / ログイン / ログアウト）実装済み
- Docker + Nginx で HTTPS 対応
- GitHub Flow（main + feature ブランチ運用）

---

## 現在の作業ブランチ
- ブランチ名  
  feature/flask-blueprint-refactor

- 作業概要  
  Blueprint 化および Application Factory パターン導入による  
  アプリ構成のリファクタリング

---

## 作業背景・判断理由
- 機能追加（メール送信）を進める前に、保守性・拡張性を優先
- 単一 app.py 構成では今後の機能追加時に責務が肥大化すると判断
- 実務を意識し、Blueprint + factory パターン構成へ移行する方針とした

---

## 本日の対応内容
- Flask CLI の挙動（FLASK_APP・自動探索・ImportError時の挙動）を整理
- main Blueprint を作成し、最小限のルーティング（"/"）を実装
- Flask-Login における user_loader 未定義時の例外発生を確認・原因を把握
- 最低限アプリが起動し、ルーティングが実行されることを確認

---

## 実装済み / 確認済み事項
- Git ブランチ運用整理（feature ブランチ作成・main の安定化）
- 環境変数の分離運用
  - .env.app（アプリ用）
  - .env.db（DB 用）
- Blueprint / Factory パターン導入後の起動確認
- wsgi.py 経由での起動経路固定
- Flask-Login の動作仕様を確認
  - current_user 使用時は user_loader 定義が必須
  - 未定義の場合は Missing user_loader 例外が発生することを確認
- Flask CLI が FLASK_APP を基準に import を行っていることを確認

---

## 未対応 / 次にやること
- Flask-Login の正式実装
  - User モデル定義（UserMixin）
  - user_loader の実装
- auth Blueprint の実装
  - /login /logout ルーティング
- tasks Blueprint の実装
- Flask-Mail 導入
- MailHog を用いたメール送信・受信確認
- Gunicorn を用いた本番環境起動コマンドの追加
- feature ブランチ完了後、main へマージ

---

## 起動・確認手順
### Docker 起動
docker-compose up --build

### MailHog 確認
http://localhost:8025

### アプリ確認
http://localhost:5001  
https://localhost

---

## Git 操作メモ
git status  
git branch  

### feature → main マージ手順
git checkout main  
git pull  
git merge feature/flask-blueprint-refactor  
git push  

---

## 注意点
- .env / 証明書 / 永続ボリュームは Git 管理外
- main ブランチは常にデプロイ可能な状態を維持
- 作業途中のコードは必ず feature ブランチで管理
- 起動経路は wsgi.py に集約済み
- Flask CLI の自動探索挙動に依存しない構成としている