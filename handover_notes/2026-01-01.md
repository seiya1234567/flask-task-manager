# ================================
# Handover Notes
# ================================

## プロジェクト概要
- Flask + SQLAlchemy のタスク管理アプリ
- 認証（登録 / ログイン / ログアウト）実装済み
- Docker + Nginx によるコンテナベース構成
- GitHub Flow（main + feature ブランチ運用）

---

## 現在の作業ブランチ
- ブランチ名  
  feature/flask-blueprint-refactor

- 作業概要  
  Blueprint 化および Application Factory パターン導入による  
  アプリ構成のリファクタリング

---

## 本日の対応内容
- auth Blueprint の validation 実装
  - 新規登録時の入力値チェックを実装
    - ユーザー名 / email の必須チェック
    - ユーザー名 / email の重複チェック
    - パスワード / 確認用パスワードの必須チェック
    - パスワード一致チェック
  - validation エラーは flash を用いて表示
  - confirm ルートは使用せず、register ルート内で完結するフローに統一
    - GET /register : フォーム表示
    - POST /register : validation → DB登録 → 登録完了モーダル表示
  - 不正 POST 時は flash エラーを表示し、register 画面へリダイレクト

- DB 登録処理の例外ハンドリング整理
  - IntegrityError を try / except で捕捉
  - rollback を必ず実行
  - 重複登録時のエラーメッセージ表示を確認
  - 試験目的で意図的に例外を発生させ、挙動を確認

- profile Blueprint 実装済み（再確認）
  - ユーザー名 / email 変更処理
  - パスワード変更処理
  - validation エラー時の表示確認

- Blueprint / Application Factory 構成の再確認
  - 全 Blueprint の登録確認
  - extensions.py は定義のみとし、循環 import を回避
  - DB 操作は extensions から db を import する方針を維持

---

## 実装済み / 確認済み事項
- auth Blueprint
  - ログイン成功 / 失敗時の処理
  - ログアウト処理
  - 新規ユーザー登録フロー（confirm 画面なし）の正常動作確認
  - DB 制約エラー時の例外処理確認
- tasks Blueprint
  - タスク一覧表示
  - フィルタ処理
  - 新規作成 / 編集 / 削除の CRUD 操作
- profile Blueprint
  - ユーザー名 / email 変更処理
  - パスワード変更処理
  - validation エラー時の表示確認
- ログイン → tasks → profile 操作 → ログアウトまでの一連の Web 操作が正常動作
- セッション Cookie による認証状態保持を確認
- docker-compose + env-file 構成でのアプリ起動確認
- Blueprint / Factory 構成を維持したまま、主要機能が動作することを確認

---

## 未対応 / 次にやること
- auth Blueprint の整理
  - validation メッセージ形式の統一
  - エラー key / category 設計の最終整理
- WTForms 導入有無の最終判断
- Flask-Mail 導入
- MailHog を用いたメール送信・受信確認
- pytest 導入検討（auth / tasks / profile の基本テスト）
- Gunicorn 本番起動コマンドの追加
- feature ブランチ完了後、main へマージ

---

## 起動・確認手順
### Docker 起動
docker compose --env-file env/.env up -d

### アプリ確認
http://localhost:5001  
https://localhost

---

## Git 操作メモ
git status  
git branch  

### コミット & Push
git add .
git commit -m "feat: implement auth validation and consolidate register flow"
git push origin feature/flask-blueprint-refactor

---

## 注意点
- .env / env/* / 証明書 / 永続ボリュームは Git 管理外
- main ブランチは常にデプロイ可能な状態を維持
- 作業途中のコードは必ず feature ブランチで管理
- Blueprint は 1 箇所で生成し、import は役割を分ける
- 起動経路は wsgi.py に集約済み
- confirm 画面は廃止し、register ルート内で完結するフローを採用
