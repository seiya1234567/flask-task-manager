# ================================
# Handover Notes
# ================================

## プロジェクト概要
- Flask + SQLAlchemy のタスク管理アプリ
- 認証（登録 / ログイン / ログアウト）実装中
- Docker + Nginx によるコンテナベース構成
- GitHub Flow（main + feature ブランチ運用）

---

## 現在の作業ブランチ
- ブランチ名  
  feature/flask-blueprint-refactor

- 作業概要  
  Blueprint 化および Application Factory パターン導入による  
  アプリ構成のリファクタリング

---

## 本日の対応内容
- docker-compose における環境変数管理方針を整理
  - `--env-file` オプションによる環境別切り替えを確認
  - 「コンテナ起動用の変数」と「アプリ内で使用する変数」の役割を整理
- env ファイルを専用ディレクトリ（env/）に集約
  - docker compose 起動コマンド  
    `docker compose --env-file env/.env up -d`
- auth Blueprint の実装を進行
  - ログイン処理（認証成功 / 失敗）を実装・動作確認
  - ログアウト処理を実装（@login_required 適用）
- Blueprint の責務整理を再確認
  - auth：認証・認可（login / logout / register）
  - profile：ユーザー情報変更（将来実装）
- routes.py / __init__.py における Blueprint 定義・import 役割を整理
  - Blueprint は 1 箇所で生成する設計とする方針を確認
- Flask-Login の利用設計を再確認
  - 認証状態の参照（current_user）は各 Blueprint で使用可
  - import 自体は設計上問題ないことを確認

---

## 実装済み / 確認済み事項
- auth Blueprint にて以下を確認
  - ログイン成功時の認証処理
  - ログイン失敗時のエラーハンドリング
  - ログアウト処理の正常動作
- セッション Cookie による認証状態保持を確認
- docker-compose + env-file 構成でのアプリ起動確認
- Blueprint / Factory 構成を維持したまま認証処理が動作することを確認

---

## 未対応 / 次にやること
- auth Blueprint の整理
  - forms.py（WTForms 導入有無の検討）
  - register（新規登録）機能の実装
- tasks Blueprint 実装
  - /tasks ルーティング
  - @login_required 適用
- profile Blueprint 実装
  - パスワード変更 / アカウント管理
- Flask-Mail 導入
- MailHog を用いたメール送信・受信確認
- Gunicorn 本番起動コマンドの追加
- feature ブランチ完了後、main へマージ

---

## 起動・確認手順
### Docker 起動
docker compose --env-file env/.env up -d

### アプリ確認
http://localhost:5001  
https://localhost

---

## Git 操作メモ
git status  
git branch  

### コミット & Push
git add .
git commit -m "refactor: add auth blueprint and login/logout logic"
git push origin feature/flask-blueprint-refactor

---

## 注意点
- .env / env/* / 証明書 / 永続ボリュームは Git 管理外
- main ブランチは常にデプロイ可能な状態を維持
- 作業途中のコードは必ず feature ブランチで管理
- Blueprint は 1 箇所で生成し、import は役割を分ける
- 起動経路は wsgi.py に集約済み
