# ================================
# Handover Notes
# ================================

## プロジェクト概要
- Flask + SQLAlchemy のタスク管理アプリ
- 認証（登録 / ログイン / ログアウト）実装
- Docker + Nginx によるコンテナベース構成
- GitHub Flow（main + feature ブランチ運用）

---

## 現在の作業ブランチ
- ブランチ名  
  feature/flask-blueprint-refactor

- 作業概要  
  Blueprint 化および Application Factory パターン導入による  
  アプリ構成のリファクタリング

---

## 本日の対応内容
- profile 機能の着手
  - profile モーダル UI の調整
  - ユーザー情報変更・パスワード変更を想定した設計検討を開始

- validation 設計の整理
  - 新規登録時・プロフィール変更時で共通化可能な validation を切り出す方針を検討
  - validators.py による関数ベース validation の方向性を整理
  - パスワード変更用 validation（現在パスワード確認 / 文字数 / 一致確認）を実装

- Jinja2 / flash の役割整理
  - flash は一時的な通知・エラーメッセージ用途
  - Jinja2 は表示ロジック・フォーム描画を担当する方針を確認

- Jinja2 フィルタの整理
  - JST 表示用フィルタ（to_jst）を extensions.py に配置
  - Application Factory（create_app）内でフィルタ登録
  - TemplateAssertionError（No filter named 'to_jst'）の解消を確認

- Blueprint / Application Factory 構成の再確認
  - Blueprint は 1 箇所で生成
  - extensions.py は定義のみに限定し、循環 import を回避
  - DB 操作時は extensions から db を import する設計を再確認

---

## 実装済み / 確認済み事項
- auth Blueprint
  - ログイン成功 / 失敗時の処理
  - ログアウト処理の正常動作
  - 新規ユーザー登録フローの動作確認
- tasks Blueprint
  - タスク一覧表示
  - フィルタ処理
  - 新規作成 / 編集 / 削除の CRUD 操作
- ログイン → tasks ページ遷移 → 各操作 → ログアウトまでの一連の Web 操作が正常動作
- セッション Cookie による認証状態保持を確認
- docker-compose + env-file 構成でのアプリ起動確認
- Blueprint / Factory 構成を維持したまま、認証・タスク管理機能が動作することを確認

---

## 未対応 / 次にやること
- auth Blueprint の整理
  - 新規登録時 validation の強化（入力値チェックの網羅）
  - confirm ルート側での再 validation（直接 POST 対策）
  - WTForms 導入有無の最終判断
- profile Blueprint 実装
  - ユーザー名 / email 変更処理
  - パスワード変更処理の本実装
  - validation の共通化（auth / profile）
- Flask-Mail 導入
- MailHog を用いたメール送信・受信確認
- pytest 導入検討（auth / tasks / profile の基本テスト）
- Gunicorn 本番起動コマンドの追加
- feature ブランチ完了後、main へマージ

---

## 起動・確認手順
### Docker 起動
docker compose --env-file env/.env up -d

### アプリ確認
http://localhost:5001  
https://localhost

---

## Git 操作メモ
git status  
git branch  

### コミット & Push
git add .
git commit -m "feat: add user registration and validation design"
git push origin feature/flask-blueprint-refactor

---

## 注意点
- .env / env/* / 証明書 / 永続ボリュームは Git 管理外
- main ブランチは常にデプロイ可能な状態を維持
- 作業途中のコードは必ず feature ブランチで管理
- Blueprint は 1 箇所で生成し、import は役割を分ける
- 起動経路は wsgi.py に集約済み
